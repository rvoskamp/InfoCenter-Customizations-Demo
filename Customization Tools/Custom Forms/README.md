# Using Custom Forms Within InfoCenter

## Overview

InfoCenter supports the use of custom forms to either display or obtain information. This is accomplished by using the **forms.json** file to define the forms that will then be referenced by your *code.js* file. 

The JSON file consists of a list of forms:
```json
{
	"forms": [

    ]
}
```

Each form definition is a dictionary with required keys and a list of field definitions (*defs*).

To assist with these form definitions we have included **FRM_2_JSON.py** to convert forms from DM Designer into the required InfoCenter format.

---

## Adding Custom Forms

Start by using DM Designer to create the form and save it as an *.frm* file. Drag & drop that *.frm* file onto the FRM_2_JSON.py file and two new files will be created in the same name and location as the *.frm* file.

| File                  | Description |
| --------------------- | ----------- |
| *\<form name>*.frm    | Form generated by eDOCS Designer  |
| *\<form name>*.json   | JSON format of supplied file      |
| *\<form name>*.log    | Processing log of supplied file   |

Copy the contents of the *.json* file and paste it into **forms.json** file:
```JSON
{
	"forms": [
```

- *Paste contents here*

```JSON
    ]
}
```

---

## Field Visibility Controls

Infocenter allows you to define forms that will show and hide fields based on another field's value. These visibility triggers, *vistriggers*, will have to added manual to the form definition.

The additional *vistriggers* is a list of key-value pairs defining when specific fields should be shown or hidden.


| Key      | Value description                                  |
| -------- | -------------------------------------------------- |
| *values* | List of values when visibility should change       |
| *fields* | List of fields to show or hide                     |
| *hidden* | Boolean if the specified fields should be hidden   |


**Example:** An optional field should ony be shown with the value of "2"
```JSON
    "vistriggers": [
        {"values": ["0","1"],"fields": ["OPTIONAL_FIELD"], "hidden": true},
        {"values": ["2"],"fields": ["OPTIONAL_FIELD"], "hidden": false}
    ]
```

**Example:** Only show the relevant field based on the selected option
```JSON
    "vistriggers": [
        {"values": ["A"],"fields": ["RELEVANT_FIELD_A"], "hidden": false},
        {"values": ["A"],"fields": ["RELEVANT_FIELD_B","RELEVANT_FIELD_C"], "hidden": true},
        {"values": ["B"],"fields": ["RELEVANT_FIELD_B"], "hidden": false},
        {"values": ["B"],"fields": ["RELEVANT_FIELD_A","RELEVANT_FIELD_C"], "hidden": true},
        {"values": ["C"],"fields": ["RELEVANT_FIELD_C"], "hidden": false},
        {"values": ["C"],"fields": ["RELEVANT_FIELD_A","RELEVANT_FIELD_B"], "hidden": true}
    ]
```

---

## Buttons

### Adding functionality

Although the tool to convert *.frm* files to *'.json'* will support (CMSPush) buttons it's functionality must be added manually. The script trigger, *scripttrigger*, defines which script to execute when the user presses the button.
```JSON
    "scripttrigger": {"script": "--- Replace with script name (as defined in code.js) ---"}
```

**Example:** Run the "hello_world" script when the button is pressed
```JSON
    {
        "fldtype": "push",
        "name": "HELLO",
        "prompt": "Hello",
        "flags": "0x00000000",
        "scripttrigger": { "script": "hello_world" }
    }
```

The script to execute must be defined in your *code.js* file within the command hanlder:
```JS
	hello_world: function(form, formFields, field, control) {
      ICC.globals.notify.success('Custom Code Says', `Hello world`);
    }
```
| Parameter      | Description                                                                              |
| -------------- | ---------------------------------------------------------------------------------------- |
| *form*         | Form wrapper. Interface to form fields                                                   |
| *formFields*   | Name of the button that was pressed. Allows multiple buttons to share the same script    |
| *field*        | undefined                                                                                |
| *control*      | undefined                                                                                |

To manipulate individual fields on the form the *form* parameter provides an interface to the fields.
```JS
    form.getFieldValue(field_name);
    form.setFieldValue(field_name,value);
    form.setHidden(field_name,boolean);
    form.setReadOnly(field_name,boolean);
```

### Associating buttons

When multiple buttons are defined there may be a need to associate them and have them rendered together. This is done by adding *extensionparent* to identify which other it should be grouped with.
```JSON
    "extensionparent": button
```

**Example:** Associate the "Modify" and "Remove" buttons with the "Add" button
```JSON
    {
        "fldtype": "push",
        "name": "ADD_ENTRY",
        "prompt": "Add",
        "flags": "0x00000000",
        "scripttrigger": { "script": "shared_update_script" }
    },
    {
        "fldtype": "push",
        "name": "MODIFY_ENTRY",
        "prompt": "Modify",
        "flags": "0x00000000",
        "scripttrigger": { "script": "shared_update_script" },
        "extensioinparent": "ADD_ENTRY"
    }
    {
        "fldtype": "push",
        "name": "REMOVE_ENTRY",
        "prompt": "Remove",
        "flags": "0x00000000",
        "scripttrigger": { "script": "remove_script" },
        "extensioinparent": "ADD_ENTRY"
    }
```


## Boxes

When fields are located within a box the tool will support the translation of (CMSBox) boxes but the fields must be added manually. Move the field definitions into the list of fields.
```JSON
    "fields": [
            "--- Replace with field definitions ---"
        ]
```
**Example:** Associate the "Modify" and "Remove" buttons with the "Add" button
```JSON
    {
        "fldtype": "box",
        "x": 17,
        "y": 286,
        "w": 497,
        "h": 107,
        "flags": 0,
        "prompt": "Information",
        "fields": [
            {
                "fldtype": "edit",
                "x": 282,
                "y": 58,
                "w": 232,
                "h": 21,
                "flags": 524292,
                "name": "CLIENT_NAME",
                "prompt": "Full Name",
                "sqlinfo": "MATTER.CLIENT_ID.CLIENT_NAME;DOCSADM.CLIENT.SYSTEM_ID"
            },
            {
                "fldtype": "edit",
                "x": 282,
                "y": 83,
                "w": 232,
                "h": 21,
                "flags": 524292,
                "name": "MATTER_NAME",
                "prompt": "Full Name",
                "sqlinfo": "MATTER.MATTER_NAME;DOCSADM.MATTER.SYSTEM_ID",
                "maxchars": "60"
            }
        ]
    },
```